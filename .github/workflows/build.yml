name: Build Input Leap for Raspberry Pi

# This section allows you to trigger the workflow manually
on:
  workflow_dispatch:  # This event enables manual triggering
    inputs:
      version:
        description: 'Which version to build'
        required: true
        default: 'latest'
      architecture:
        description: 'Which architecture to target (e.g., arm, arm64)'
        required: true
        default: 'arm64'

jobs:
  build:
    runs-on: ubuntu-24.04  # Ensure we are using the correct Ubuntu version

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up ARM cross-compilation toolchain
      run: |
        sudo apt-get update
        sudo apt-get install -y gcc-arm-linux-gnueabihf g++-arm-linux-gnueabihf cmake make

    - name: Add Qt 6 PPA and install dependencies
      run: |
        # Add Qt 6 repository for Ubuntu 24.04 (ensure you are using the correct version)
        sudo add-apt-repository ppa:beineri/opt-qt-6.5.0-bullseye
        sudo apt-get update
        # Install necessary Qt 6 development packages
        sudo apt-get install -y qt6-qmake qt6-base-dev libx11-dev libxext-dev libxrender-dev \
        libssl-dev libavahi-compat-libdnssd-dev

    - name: Create build directory
      run: mkdir build

    - name: Run CMake
      run: |
        cd build
        cmake -DCMAKE_TOOLCHAIN_FILE=../toolchain-arm64.cmake ..

    - name: Build Input Leap for Raspberry Pi
      run: |
        cd build
        make -j4  # Adjust based on the number of CPU cores

    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: build-output
        path: ./output/